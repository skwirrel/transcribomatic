# Transcribomatic

**Transcribomatic** is a web-based real-time speech transcription application that converts spoken language into text using OpenAI's Realtime API. Built for multi-tenant use, it provides secure token-based authentication, comprehensive usage tracking with weekly cost limits, and AI-generated visual aids to enhance communication. The system prioritizes privacy by tracking only word counts rather than actual speech content, making it ideal for individuals, educators, and organizations who need reliable speech-to-text functionality with built-in cost controls and user management.

**Copyright Â© 2025 Ben Jefferson**

## Features

- ğŸ¤ **Real-time speech transcription** using OpenAI's Realtime API via WebRTC
- ğŸ” **Multi-tenant authentication** with HMAC-signed tokens
- ğŸ‘¥ **User management** with configurable features per user
- ğŸ’° **Cost tracking & limits** with $2.00 weekly spending caps per user
- ğŸ“Š **Privacy-first analytics** - tracks word counts, not actual transcription text
- ğŸ–¼ï¸ **AI-generated pictograms** using DALL-E for visual communication aids
- ğŸ“± **Responsive design** optimized for mobile and desktop
- âš¡ **High performance** with optimized database indexes and UNIX timestamps

## Architecture

- **Frontend**: Pure HTML/CSS/JavaScript with WebRTC
- **Backend**: PHP with MySQL database
- **APIs**: OpenAI Realtime API, OpenAI Images API (DALL-E)
- **Authentication**: HMAC-signed tokens with dual contexts (management/user)
- **Database**: MySQL with compound indexes for efficient queries

## Quick Start

### Prerequisites

- PHP 7.4+ with cURL extension
- MySQL 5.7+ or MariaDB 10.3+
- Web server (Apache/Nginx) with HTTPS support
- OpenAI API key with Realtime API access

### Installation

1. **Clone the repository**
   ```bash
   git clone https://github.com/skwirrel/transcribomatic.git
   cd transcribomatic
   ```

2. **Configure the application**
   ```bash
   cp config/config.example.php config/config.php
   ```
   Edit `config/config.php` with your settings:
   - OpenAI API key
   - Database credentials
   - Domain/path configuration

3. **Set up the database**
   ```bash
   mysql -u root -p < scripts/database_schema.sql
   ```

4. **Generate signed model parameters**
   ```bash
   php scripts/signModel.php gpt-4o-realtime-preview
   ```
   This creates the `public/signedModel.js` file required for secure API access.

5. **Configure your web server**
   - Point document root to the `public/` directory
   - Ensure HTTPS is enabled (required for microphone access)
   - Enable PHP and set appropriate permissions

6. **Generate management tokens**
   ```bash
   php scripts/generateTokens.php 5
   ```
   This creates 5 management URLs for setting up user accounts.

## Configuration

### Database Setup

The application requires these MySQL tables:
- `Users` - User configuration and settings
- `ApiUsage` - General activity logging (login, transcription word counts, images)
- `UsageLog` - Detailed token usage tracking for cost calculation
- `UsageCost` - Historical cost tracking ledger

### User Management

1. **Create users**: Use the management URLs generated by `generateTokens.php`
2. **Configure features**: Each user can enable/disable:
   - Real-time transcription display
   - Paralanguage context information
   - AI-generated visual aids
3. **Share access**: Users receive personal URLs for accessing the transcription app

### Cost Management

- **Weekly limits**: Each user has a $2.00 weekly spending limit
- **Automatic tracking**: Costs are calculated and enforced automatically
- **Detailed logging**: Track token usage, image generation, and costs
- **Privacy-first**: Only word counts are stored, never actual transcription text

## API Usage Tracking

The system tracks three types of data:

1. **General Activity** (`ApiUsage` table)
   - Login attempts
   - Management page access
   - Image generation requests
   - Transcription sessions (word counts only)

2. **Detailed Token Usage** (`UsageLog` table)
   - Input/output token counts
   - Text vs audio token breakdown
   - Cached token utilization
   - Precise cost calculations

3. **Historical Costs** (`UsageCost` table)
   - Weekly cost rollups
   - Efficient reporting
   - Long-term usage trends

## Security Features

- **HMAC token validation** prevents tampering
- **Server-side API proxying** protects OpenAI keys
- **Weekly spending limits** prevent runaway costs
- **Privacy-first logging** - no actual speech content stored
- **Secure configuration** - API keys in ignored config files

## Development

### Project Structure
```
transcribomatic/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ config.example.php    # Configuration template
â”‚   â””â”€â”€ config.php           # Your configuration (git-ignored)
â”œâ”€â”€ lib/
â”‚   â””â”€â”€ auth.php            # Authentication and database functions
â”œâ”€â”€ public/
â”‚   â”œâ”€â”€ index.html          # Main transcription application
â”‚   â”œâ”€â”€ manage.php          # User management interface
â”‚   â”œâ”€â”€ openai.php          # OpenAI API proxy
â”‚   â””â”€â”€ generate_image.php  # Image generation endpoint
â””â”€â”€ scripts/
    â”œâ”€â”€ database_schema.sql     # Database creation script
    â”œâ”€â”€ generateTokens.php      # Token generation utility
    â””â”€â”€ migrate_to_unix_timestamps.sql  # Database migration script
```

### Key Technologies
- **WebRTC**: Direct connection to OpenAI Realtime API
- **UNIX Timestamps**: Efficient date/time storage and calculations
- **Compound Indexes**: Optimized for `(uniqueId, createdAt)` queries
- **HMAC Signatures**: Secure token validation
- **Responsive CSS**: Mobile-first design with desktop optimization

## Cost Structure

Current OpenAI API pricing (configurable in `config.php`):

**Text Tokens:**
- Input: $5.00 / 1M tokens
- Cached: $2.50 / 1M tokens
- Output: $20.00 / 1M tokens

**Audio Tokens:**
- Input: $40.00 / 1M tokens  
- Cached: $2.50 / 1M tokens
- Output: $80.00 / 1M tokens

**Images:** $0.011 per image

## Browser Requirements

- Modern browser with WebRTC support
- HTTPS connection (required for microphone access)
- JavaScript enabled
- Microphone permissions

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test thoroughly
5. Submit a pull request

## License

This project is licensed under the GNU General Public License v3.0 - see the [LICENSE](LICENSE) file for details.

## Support

For issues and questions, please use the GitHub issue tracker.

---

**Built with â¤ï¸ using OpenAI's Realtime API and modern web technologies.**
